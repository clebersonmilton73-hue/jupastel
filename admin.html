<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jupastel ‚Äî Admin</title>
  <style>
    :root{--g:#0f7a3a;--g2:#0a5a2b;--y:#ffd34d;--y2:#ffb703;--bg:#f7fff2;--card:#fff;--ink:#161616;--muted:#5b5b5b;--shadow:0 12px 28px rgba(0,0,0,.12);--r:18px}
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(900px 650px at 12% 0%, rgba(255,211,77,.45), transparent 60%),
               radial-gradient(900px 650px at 95% 12%, rgba(15,122,58,.30), transparent 55%),
               linear-gradient(180deg, #fff8e6 0%, var(--bg) 100%);
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    header{background:linear-gradient(135deg,var(--g),var(--g2));border-radius:22px;box-shadow:var(--shadow);padding:18px;position:relative;overflow:hidden}
    header:before{content:"";position:absolute;right:-120px;top:-140px;width:360px;height:360px;border-radius:999px;background:radial-gradient(circle at 30% 30%, rgba(255,211,77,.95), rgba(255,211,77,.15) 60%, transparent 70%);transform:rotate(20deg)}
    .top{position:relative;display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:54px;height:54px;border-radius:16px;background:linear-gradient(135deg,var(--y),var(--y2));display:grid;place-items:center;font-size:28px;box-shadow:0 10px 18px rgba(0,0,0,.20)}
    .brand h1{margin:0;color:#fff;font-size:clamp(20px,2.6vw,30px);font-weight:900;line-height:1.05}
    .pill{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;padding:10px 12px;border-radius:999px;font-weight:800;font-size:13px;backdrop-filter: blur(6px);display:flex;align-items:center;gap:8px}
    .card{margin-top:16px;background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);border:1px solid rgba(15,122,58,.10);overflow:hidden}
    .hd{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:10px;background:linear-gradient(180deg, rgba(15,122,58,.06), rgba(255,211,77,.18));border-bottom:1px solid rgba(0,0,0,.06)}
    .hd h2{margin:0;color:var(--g2);font-size:16px;font-weight:950;display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--y),var(--y2));box-shadow:0 4px 10px rgba(0,0,0,.14)}
    .body{padding:14px 16px}
    .muted{color:var(--muted);font-size:12px;line-height:1.35}
    .inp{padding:10px;border-radius:12px;border:1px solid rgba(0,0,0,.18);outline:none;font-size:14px;width:100%}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    @media(max-width:520px){.two{grid-template-columns:1fr}}
    .btn{border:none;cursor:pointer;padding:10px 12px;border-radius:14px;font-weight:900;display:inline-flex;align-items:center;gap:8px;user-select:none}
    .btn-ghost{background:rgba(0,0,0,.05);color:var(--ink)}
    .btn-warn{background:linear-gradient(135deg,#ff5a5a,#d81b1b);color:#fff}
    .btn-add{background:linear-gradient(135deg,var(--g),var(--g2));color:#fff;box-shadow:0 10px 18px rgba(15,122,58,.20)}
    .orders{display:flex;flex-direction:column;gap:10px}
    .order{border:1px solid rgba(0,0,0,.08);border-radius:16px;padding:12px;background:#fff}
    .order-top{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-weight:900;font-size:12px;border:1px solid rgba(0,0,0,.10);background:#f6f6f6}
    .badge.new{background:rgba(255,183,3,.25)}
    .badge.progress{background:rgba(15,122,58,.12)}
    .badge.done{background:rgba(0,180,100,.15)}
    .badge.cancel{background:rgba(255,90,90,.18)}
    .order-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .hidden{display:none !important}

    /* lock */
    #lock{
      position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.55);
      display:flex;align-items:center;justify-content:center;padding:18px;
    }
    .lockbox{
      width:min(520px,100%);background:#fff;border-radius:18px;box-shadow:0 18px 40px rgba(0,0,0,.25);
      overflow:hidden;border:1px solid rgba(0,0,0,.12);
    }
    .lockhd{
      padding:14px 16px;background:linear-gradient(180deg, rgba(15,122,58,.06), rgba(255,211,77,.22));
      border-bottom:1px solid rgba(0,0,0,.06);font-weight:950;color:#0a5a2b;
    }
    .lockbd{padding:16px}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="top">
      <div class="brand">
        <div class="logo">üõ†Ô∏è</div>
        <div>
          <h1>Admin ‚Äî Jupastel</h1>
          <div class="muted" style="color:rgba(255,255,255,.9)">Gerencie pedidos (neste navegador)</div>
        </div>
      </div>
      <div class="pill">üîí Protegido por senha</1234>
    </div>
  </header>

  <section class="card">
    <div class="hd">
      <h2><span class="dot"></span> Pedidos</h2>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn btn-ghost" id="exportBtn">‚¨áÔ∏è Exportar JSON</button>
        <button class="btn btn-warn" id="clearOrdersBtn">üóëÔ∏è Limpar tudo</button>
      </div>
    </div>
    <div class="body">
      <div class="two">
        <input id="adminSearch" class="inp" placeholder="Buscar por nome, telefone, ID, status..." />
        <select id="adminFilter" class="inp">
          <option value="">Filtrar: Todos</option>
          <option value="Novo">Novo</option>
          <option value="Em preparo">Em preparo</option>
          <option value="Saiu para entrega">Saiu para entrega</option>
          <option value="Finalizado">Finalizado</option>
          <option value="Cancelado">Cancelado</option>
        </select>
      </div>
      <div style="margin-top:10px" class="muted">
        Observa√ß√£o: pedidos ficam salvos no aparelho do cliente. Para ver pedidos de todos os clientes, precisa servidor (posso montar depois).
      </div>
      <div style="margin-top:14px" class="orders" id="orders"></div>
    </div>
  </section>
</div>

<!-- LOCK -->
<div id="lock">
  <div class="lockbox">
    <div class="lockhd">üîí Digite a senha do Admin</1234>
    <div class="lockbd">
      <div class="muted" style="margin-bottom:10px">Apenas voc√™ deve entrar aqui.</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="pass" class="inp" type="password" placeholder="Senha" style="flex:1;min-width:180px">
        <button class="btn btn-add" id="unlockBtn">‚úÖ Entrar</button>
      </div>
      <div id="msg" class="muted" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<script>
  // ======= CONFIG =======
  const ADMIN_PASSWORD = "4321"; // TROQUE AQUI
  const LS_ORDERS  = "jupastel_orders_v1";
  const SESSION_OK = "jupastel_admin_ok";

  const brl = (v)=> v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  const nowBR = ()=> new Date().toLocaleString("pt-BR");

  function loadOrders(){ try{return JSON.parse(localStorage.getItem(LS_ORDERS)||"[]")}catch{return[]} }
  function saveOrders(arr){ localStorage.setItem(LS_ORDERS, JSON.stringify(arr)); }

  // Lock
  const lock = document.getElementById("lock");
  const pass = document.getElementById("pass");
  const unlockBtn = document.getElementById("unlockBtn");
  const msg = document.getElementById("msg");

  function isUnlocked(){ return sessionStorage.getItem(SESSION_OK)==="1"; }
  function unlock(){
    if((pass.value||"").trim() === ADMIN_PASSWORD){
      sessionStorage.setItem(SESSION_OK,"1");
      lock.classList.add("hidden");
      render();
    }else{
      msg.textContent = "‚ùå Senha incorreta.";
      pass.value="";
      pass.focus();
    }
  }
  unlockBtn.onclick = unlock;
  pass.addEventListener("keydown",(e)=>{ if(e.key==="Enter") unlock(); });

  // Admin
  const elOrders = document.getElementById("orders");
  const adminSearch = document.getElementById("adminSearch");
  const adminFilter = document.getElementById("adminFilter");
  const exportBtn = document.getElementById("exportBtn");
  const clearOrdersBtn = document.getElementById("clearOrdersBtn");

  function statusBadgeClass(s){
    if(s==="Novo") return "new";
    if(s==="Em preparo" || s==="Saiu para entrega") return "progress";
    if(s==="Finalizado") return "done";
    if(s==="Cancelado") return "cancel";
    return "";
  }

  function setOrderStatus(id, status){
    const orders = loadOrders();
    const o = orders.find(x=>x.id===id);
    if(!o) return;
    o.status = status;
    saveOrders(orders);
    render();
  }

  function deleteOrder(id){
    let orders = loadOrders();
    orders = orders.filter(x=>x.id!==id);
    saveOrders(orders);
    render();
  }

  function abrirComprovanteLoja(order){
    const itensHtml=(order.items||[]).map(i=>`
      <tr>
        <td style="padding:8px;border-bottom:1px solid #ddd">${i.qty}x</td>
        <td style="padding:8px;border-bottom:1px solid #ddd">${i.name}</td>
        <td style="padding:8px;border-bottom:1px solid #ddd">${brl(i.unit)}</td>
        <td style="padding:8px;border-bottom:1px solid #ddd">${brl(i.sub)}</td>
      </tr>`).join("");

    const html=`<!doctype html><html lang="pt-br"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Comprovante</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;color:#111}
.box{max-width:780px;margin:0 auto;border:1px solid #ddd;border-radius:14px;padding:16px}
h1{margin:0 0 6px}.muted{color:#555;font-size:12px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th{background:#f2f2f2;text-align:left;padding:8px;border-bottom:1px solid #ddd}
.row{display:flex;gap:10px;flex-wrap:wrap}
.pill{display:inline-block;background:#f7f7f7;border:1px solid #ddd;border-radius:999px;padding:6px 10px;font-weight:bold}
.total{font-size:18px;font-weight:900;margin-top:10px}
@media print{button{display:none}}
</style></head><body>
<div class="box">
  <div class="row" style="align-items:center;justify-content:space-between">
    <div><h1>üßæ Comprovante do Pedido</h1><div class="muted">Emitido em: ${nowBR()}</div></div>
    <div class="pill">Pedido: ${order.id}</div>
  </div>
  <div style="margin-top:10px" class="row">
    <div><strong>Cliente:</strong> ${order.customer?.nome||"‚Äî"}</div>
    <div><strong>Telefone:</strong> ${order.customer?.telefone||"‚Äî"}</div>
    <div style="flex:1 1 100%"><strong>Endere√ßo:</strong> ${order.customer?.endereco||"‚Äî"}</div>
    <div><strong>Pagamento:</strong> ${order.customer?.pagamento||"‚Äî"}</div>
    <div><strong>Status:</strong> ${order.status}</div>
  </div>
  <table><thead><tr><th>Qtd</th><th>Item</th><th>Unit.</th><th>Subtotal</th></tr></thead>
  <tbody>${itensHtml}</tbody></table>
  <div class="total">Total: ${brl(order.total)}</div>
  <button onclick="window.print()" style="margin-top:12px;padding:10px 14px;font-weight:900;border-radius:12px;border:1px solid #ddd;background:#fff;cursor:pointer">
    üñ®Ô∏è Imprimir / Salvar PDF
  </button>
</div></body></html>`;
    const w=window.open("","_blank"); w.document.open(); w.document.write(html); w.document.close();
  }

  function render(){
    const q=(adminSearch.value||"").trim().toLowerCase();
    const f=(adminFilter.value||"").trim();

    let orders=loadOrders();
    if(f) orders=orders.filter(o=>o.status===f);

    if(q){
      orders=orders.filter(o=>{
        const blob=[o.id,o.status,o.createdAt,o.customer?.nome,o.customer?.telefone,o.customer?.endereco,o.customer?.pagamento,...(o.items||[]).map(i=>i.name)].join(" ").toLowerCase();
        return blob.includes(q);
      });
    }

    if(orders.length===0){
      elOrders.innerHTML = `<div class="muted">Nenhum pedido encontrado.</div>`;
      return;
    }

    elOrders.innerHTML = orders.map(o=>{
      const badgeCls=statusBadgeClass(o.status);
      const itemsShort=(o.items||[]).slice(0,3).map(i=>`${i.qty}x ${i.name}`).join(" ‚Ä¢ ");
      const more=(o.items||[]).length>3 ? ` (+${(o.items||[]).length-3} itens)` : "";

      return `
        <div class="order">
          <div class="order-top">
            <div style="display:flex;flex-direction:column;gap:4px">
              <div style="font-weight:950">Pedido ${o.id}</div>
              <div class="muted">${o.createdAt} ‚Ä¢ ${o.customer?.nome||"‚Äî"} ‚Ä¢ ${o.customer?.telefone||"‚Äî"}</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end">
              <span class="badge ${badgeCls}">üìå ${o.status}</span>
              <span class="badge">üí∞ ${brl(o.total)}</span>
            </div>
          </div>

          <div class="muted" style="margin-top:8px">${itemsShort}${more}</div>

          <div class="order-actions">
            <button class="btn btn-ghost" onclick="viewOrder('${o.id}')">üëÅÔ∏è Ver</button>
            <button class="btn btn-ghost" onclick="receipt('${o.id}')">üßæ Recibo</button>
            <button class="btn btn-add" onclick="status('${o.id}','Em preparo')">üç≥ Em preparo</button>
            <button class="btn btn-add" onclick="status('${o.id}','Saiu para entrega')">üõµ Saiu</button>
            <button class="btn btn-add" onclick="status('${o.id}','Finalizado')">‚úÖ Finalizar</button>
            <button class="btn btn-warn" onclick="status('${o.id}','Cancelado')">‚õî Cancelar</button>
            <button class="btn btn-warn" onclick="del('${o.id}')">üóëÔ∏è Apagar</button>
          </div>
        </div>
      `;
    }).join("");
  }

  window.status=(id,st)=> setOrderStatus(id,st);
  window.del=(id)=> { if(confirm("Apagar este pedido?")) deleteOrder(id); };
  window.receipt=(id)=> { const o=loadOrders().find(x=>x.id===id); if(o) abrirComprovanteLoja(o); };
  window.viewOrder=(id)=>{
    const o=loadOrders().find(x=>x.id===id); if(!o) return;
    const itens=(o.items||[]).map(i=>`${i.qty}x ${i.name} (${brl(i.unit)}) = ${brl(i.sub)}`).join("\n");
    alert(`Pedido: ${o.id}\nData: ${o.createdAt}\nStatus: ${o.status}\nTotal: ${brl(o.total)}\n\nCliente: ${o.customer?.nome||"-"}\nTelefone: ${o.customer?.telefone||"-"}\nEndere√ßo: ${o.customer?.endereco||"-"}\nPagamento: ${o.customer?.pagamento||"-"}\n\nItens:\n${itens}`);
  };

  adminSearch.addEventListener("input", render);
  adminFilter.addEventListener("change", render);

  exportBtn.onclick=()=>{
    const data=JSON.stringify(loadOrders(),null,2);
    const blob=new Blob([data],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url; a.download="pedidos_jupastel.json"; a.click();
    URL.revokeObjectURL(url);
  };

  clearOrdersBtn.onclick=()=>{
    if(!confirm("Tem certeza que quer apagar TODOS os pedidos?")) return;
    localStorage.removeItem(LS_ORDERS);
    render();
  };

  // init lock
  if(isUnlocked()){ lock.classList.add("hidden"); render(); }
  else { pass.focus(); }
</script>
</body>
</html>
